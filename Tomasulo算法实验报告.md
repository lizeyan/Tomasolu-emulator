## Tomasulo算法实验报告

##### 李则言 2014011292  吕鑫  2014011298  卫翔宇 2014011312

---

#### 一、环境配置

##### 1.环境列表

##### 2.运行方法

使用浏览器打开`index.html`

（这里可以讲前端的使用方法）

#### 二、代码结构

`tomasolu-core.js`是Tomasulo算法的核心部分，按照要求实现了完整的算法流程。

（这里可以将其他代码的用处）

#### 三、核心算法实现介绍

##### 1. Instruction类

此类代表一条指令

`status`为指令当前的运行状态，有queue、issue、exec/load/store、exec_finish/load_finish/store_finish、finish这几种状态。其中queue表示还在指令队列，未被发送，issue表示这个周期被发送，exec/load/store分别表示指令正在计算（运算指令）、加载（load指令）和存储（store指令），exec_finish/load_finish/store_finish分别表示指令计算完成、加载完成和存储完成，finish表示指令写回完成，全部执行结束。

`status_change_time`是一个列表，存储指令各种事件的时间，分别是发射指令时间(键为issue_time)，开始执行时间(键为exec_time)，执行完毕时间(键为finish_time)，写回结果时间(键为write_time)。

##### 2.ReservationContent类

此类代表一个加减或乘除保留站

`name`表示这个保留站的名字，如Add1。

`running`表示这个保留站对应的指令是否正在运算器中执行

`satisfy`表示这个保留站所需要的寄存器是否都已经满足

`compute_time`表示这个保留站对应的指令已经运算的时间

`rank`表示这个保留站在保留站集合的第几位

`ans`表示这个保留站对应的指令的运算结果

##### 3.ReservationStation类

此类代表一个加减乘除保留站集合

`add_size`表示加减保留站的数目，按照要求取3

`multi_size`表示乘除保留站的数目，按照要求取2

`add_used`表示已经使用的加减保留站的数目

`multi_used`表示已经使用的乘除保留站的数目

（注我们支持多个拥有加减或乘除运算器，`add_compute_num`和`multi_compute_num`分别代表加减和乘除运算器的个数，按照课件要求可以全部取1）

`add_compute_work`为一个数组，表示全部的加减运算器的运行状态，为-1代表闲置，为其他值i代表被第i个加减保留站占用计算资源

`multi_compute_work`为一个数组，表示全部的乘除运算器的运行状态，为-1代表闲置，为其他值i代表被第i个乘除保留站占用计算资源

`add_reservation_stations`为一个数组，表示全部的加减保留站，数组大小按照要求为3

`multi_reservation_stations`为一个数组，表示全部的乘除保留站，数组大小按照要求为2

`is_free`函数，根据指令的形式判断是否有空的保留站

`issue`函数，发射一条指令，并为这条指令分配初始化一个保留站

`work`函数，进行更新保留站寄存器，释放已经结束的指令的计算资源，分配新的计算资源等处理

`write_back`函数，将计算结束的结果写回，并更新所有同名的需要更新qj,qk

#### 四、前端实现介绍

#### 五、备注

1.按照助教邮件的回复，因为已经实现了，就没有使用流水线，而是前一条指令执行完了，后一条指令才可以继续使用计算资源，并不能同时使用。（但是实现了扩展，支持多加减或乘除器，这样可以同时在不同的运算器中计算，只是默认设置没有打开这样功能）。

2.与课件上相似，在issue的那个周期，即使运算器空闲，保留站有位置也不可以运行，这即是issue需要占用一个运行周期。

3.在一个周期内应该是先写回，再进行其他操作，类似于在第5个周期，第3个指令要写回寄存器F1，这样在第5个周期其他需要F1的指令都可以得到更新，即第5个周期便能用最新的F1的值。

4.指令的rs，rt，rd的意义是rs op rt -> rd，即是rs和rt操作，存入rd中。